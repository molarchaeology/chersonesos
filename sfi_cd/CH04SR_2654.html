<!DOCTYPE html 

     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"

     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
 <head>
  <!-- title -->
  <title>
   Chersonesos - Record View Page: CH04SR_2654
  </title>
  <!-- meta -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <!-- stylesheets -->
  <link href="../skins/arkologik/stylesheets/ark_main.css" type="text/css" rel="stylesheet" media="screen" />
  <link href="../skins/arkologik/stylesheets/ark_main_print.css" type="text/css" rel="stylesheet" media="print" />
  <link href="../skins/arkologik/stylesheets/colorbox.css" type="text/css" rel="stylesheet" />
  <link href="../skins/arkologik/images/ark_favicon.ico" rel="shortcut icon" />
  <!-- javascript libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
  </script>
  <script src="../lib/js/jquery.js" type="text/javascript">
  </script>
  <script src="../lib/js/jquery-ui.js" type="text/javascript">
  </script>
  <script src="../lib/js/php.js" type="text/javascript">
  </script>
  <script src="../lib/js/jquery.colorbox.js" type="text/javascript">
  </script>
  <script src="../lib/js/ol3/ol.js" type="text/javascript">
  </script>
  <!-- ARK javascript -->
  <script type="text/javascript" src="../js/js_functions.js">
  </script>
  <script src="../js/js_functions.js" type="text/javascript">
  </script>
  <script src="../js/livesearch.js" type="text/javascript">
  </script>
  <script src="../js/common.js" type="text/javascript">
  </script>
 </head>
 <body>
  <!-- THE CONTENT WRAPPER -->
  <div id="wrapper" class="wrp_mcrview">
   <!-- HEADER -->
   <div id="hdr-print">
    <img src="../skins/arkologik/images/logo.png" alt="logo" />
   </div>
   <div id="hdr">
    <!-- header tools -->
    <div id="hdr-tools">
     <!-- version number -->
     <div id="version">
      v1.1
     </div>
     <!-- user info -->
     <div id="user-info">
      <span>
       Guest User
      </span>
      <span>
       <a href="../micro_view.html">
        English
       </a>
      </span>
      <span>
       <a href="../micro_view.html">
        Russian
       </a>
      </span>
      <span>
       <a href="../help.html">
        Help
       </a>
      </span>
      <span class="noborder">
       <a href="../index.html">
        Logout
       </a>
      </span>
     </div>
     <!-- search box -->
     <div id="search">
      <form method="get" class="searchbox" action="/chersonesos/ark/data_view.php">
       <fieldset>
        <label>
         Search&nbsp;
        </label>
        <input type="text" name="src" />
        <input type="hidden" name="ftr_mode" value="basic" />
        <input type="hidden" name="disp_mode" value="chat" />
        <input type="hidden" name="ftype" value="ftx" />
        <input type="hidden" name="ftr_id" value="searchbox" />
        <input type="hidden" name="reset" value="1" />
        <button type="submit">
         go
        </button>
       </fieldset>
      </form>
     </div>
    </div>
    <!-- main navigation bar -->
    <div id="navcontainer">
     <ul id="navlist">
      <li>
       <a href="../user_home.html">
        home
       </a>
      </li>
      <li id="active">
       <a href="../micro_view.html">
        record view
       </a>
      </li>
      <li>
       <a href="../data_view.html">
        search
       </a>
      </li>
      <li>
       <a href="../map_view.html">
        map
       </a>
      </li>
     </ul>
    </div>
   </div>
   <!-- The LEFT PANEL -->
   <div id="lpanel">
    <h1>
     Micro View Forms
    </h1>
    <ul class="module_list" id="mvlpmodlist">
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Context" class="med" />
      </a>
      <label>
       Contexts
      </label>
      <a href="../search/key/1/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Context" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Group" class="med" />
      </a>
      <label>
       Context Groups
      </label>
      <a href="../search/key/16/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Group" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Special Find" class="med" />
      </a>
      <label>
       Special Finds
      </label>
      <a href="../search/key/11/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Special Find" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Sample" class="med" />
      </a>
      <label>
       Samples
      </label>
      <a href="../search/key/9/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Sample" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Microwear Record" class="med" />
      </a>
      <label>
       Microwear Records
      </label>
      <a href="../search/key/19/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Microwear Record" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Skeletal Remain" class="med" />
      </a>
      <label>
       Skeletal Remains
      </label>
      <a href="../search/key/20/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Skeletal Remain" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Drawing" class="med" />
      </a>
      <label>
       Drawings
      </label>
      <a href="../search/key/17/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Drawing" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Site Photo" class="med" />
      </a>
      <label>
       Site Photos
      </label>
      <a href="../search/key/3/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Site Photo" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Geophoto" class="med" />
      </a>
      <label>
       GeoPhoto Codes
      </label>
      <a href="../search/key/12/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Geophoto" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a Topo Surface" class="med" />
      </a>
      <label>
       Topo Surfaces
      </label>
      <a href="../search/key/18/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search Topo Surface" class="med" />
      </a>
     </li>
     <li>
      <a href="../micro_view.html">
       <img src="../skins/arkologik/images/plusminus/view.png" title="View a PMP" class="med" />
      </a>
      <label>
       PMPs
      </label>
      <a href="../search/key/15/all.html">
       <img src="../skins/arkologik/images/plusminus/view_mag.png" title="Search PMP" class="med" />
      </a>
     </li>
    </ul>
   </div>
   <!-- MAIN CONTENT (IN COLUMNS) -->
   <div id="main" class="main_mcrview">
    <div id="record_nav" class="record_nav">
     <div id="record_upper">
      <div class="record_upper_left">
       <div id="WPLink">
        <a href="../ https://chersonesos.la.utexas.edu.html" target="_blank">
         Search linked Wordpress for this item
        </a>
       </div>
       <div id="record_jumper">
        <div id="itemval_jumper">
         <form method="get" id="select_itemval" action="/chersonesos/ark/micro_view.php">
          <fieldset>
           <label>
            Special Find
           </label>
           <script>
            $(document).ready( function() {
                    console.log('loading');
                    $.getJSON(
                        'https://ica.tacc.utexas.edu/chersonesos/ark/itemlist/sfi_cd',
                        function(availablekeys) {
                            $( "#jumper_input" ).autocomplete({
                              source: availablekeys["itemkeys"],
                              select: function( event, ui ) {
                                window.location.href = 'https://n2t.net/ark:/87610/t66h2r/sfi_cd/' + ui.item.value;
                              }
                            })  
                        }
                    ).fail(function(jqxhr, textStatus, error ) {
                        var err = textStatus + ", " + error;
                        console.log( "Request Failed: " + err )
                    })
                  });
           </script>
           <input id="jumper_input" type="text" name="sfi_cd" value="" />
           <input type="hidden" name="item_key" value="sfi_cd" />
          </fieldset>
         </form>
        </div>
       </div>
      </div>
     </div>
     <div id="record_lower">
      <div id="permalink">
       <span>
        <label>
         Archival Resource Key:
        </label>
        <a href="http://n2t.net/ark:/87610/t66h2r/sfi_cd/CH04SR_2654">
         ark:/87610/t66h2r/sfi_cd/CH04SR_2654
        </a>
       </span>
      </div>
      <ul id="record_nav">
       <li class="current">
        CH04SR
       </li>
       <li class="current">
        2654
       </li>
      </ul>
      <ul id="record_refresh">
       <li>
        <a href="../micro_view.html" class="refresh" title="Refresh">
         &nbsp;
        </a>
       </li>
      </ul>
      <ul id="record_admin">
      </ul>
     </div>
    </div>
    <div id="column-main_column" class="primary_col">
     <div id="sfi_pubcatalogue" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Publication Catalogue
       </h4>
      </div>
      <ul>
       <li style="display:none">
        &nbsp;
       </li>
       <li style="display:none">
        &nbsp;
       </li>
       <li class="row">
        <span class="data">
         No text data has been added
        </span>
       </li>
      </ul>
     </div>
     <div id="sfi_descframe_frame" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Description
       </h4>
      </div>
      <div id="sfi_desc" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Short Description
         </label>
         <span class="data">
          Coin
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Description
         </label>
         <span class="data">
          Oxidized and encrusted bronze coin. Possibly rho-monogram type. Center appears depressed and dimensions are correct.
         </span>
        </li>
       </ul>
      </div>
      <div id="sfi_class" class="frm_subform">
       <ul class="field_list">
        <li class="row">
         <label class="form_label">
          Find Class
         </label>
         <span class="data">
          <ul class="attr_list">
           <li>
            <a href="../search/atr/54/1244/1.html">
             Coin
            </a>
            <a target="_blank" href="../concept/attribute/1244.html">
             <img src="../skins/arkologik/images/plusminus/help_over.png" alt="info" />
            </a>
           </li>
          </ul>
         </span>
        </li>
       </ul>
      </div>
      <div id="sfi_coinsdesc" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Issuing Authority
         </label>
         <span class="data">
          Rho monogram type. According to Anokhin coin of late 11th- early 12th c.
         </span>
        </li>
        <li style="display:none">
         &nbsp;
        </li>
        <li class="row">
         <label class="form_label">
          Obverse
         </label>
         <span class="data">
          Monogram of Romanus (Ρ Ω).
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Reverse
         </label>
         <span class="data">
          Cross on steps with pellets on both fields.
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Reference
         </label>
         <span class="data">
          Anokhin 1980, no 465 (but much bigger)
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Observations
         </label>
         <span class="data">
          MC 59  [?]]. Fragment (little more than half the coin)
         </span>
        </li>
       </ul>
      </div>
     </div>
     <div id="sfi_subjframe_frame" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Find Details
       </h4>
      </div>
      <div id="sfi_attr" class="frm_subform">
       <ul class="field_list">
        <li class="row">
         <label class="form_label">
          Preservation
         </label>
         <span class="data">
          <ul class="attr_list">
           <li>
            <a href="../search/atr/6/15/1.html">
             Very Good
            </a>
            <a target="_blank" href="../concept/attribute/15.html">
             <img src="../skins/arkologik/images/plusminus/help_over.png" alt="info" />
            </a>
           </li>
          </ul>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Material
         </label>
         <span class="data">
          <ul class="attr_list">
           <li>
            <a href="../search/atr/16/142/1.html">
             Bronze
            </a>
            <a target="_blank" href="../concept/attribute/142.html">
             <img src="../skins/arkologik/images/plusminus/help_over.png" alt="info" />
            </a>
           </li>
          </ul>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Period
         </label>
         <span class="data">
          <ul class="attr_list">
           <li>
            <a href="../search/atr/8/19/1.html">
             Late Byzantine (13th-14th century)
            </a>
            <a target="_blank" href="../concept/attribute/19.html">
             <img src="../skins/arkologik/images/plusminus/help_over.png" alt="info" />
            </a>
           </li>
          </ul>
         </span>
        </li>
       </ul>
      </div>
      <div id="sfi_coinattr" class="frm_subform">
       <ul class="field_list">
        <li class="row">
         <label class="form_label">
          Mint
         </label>
         <span class="data">
          <ul class="attr_list">
           <li>
            <a href="../search/atr/28/324/1.html">
             Cherson
            </a>
            <a target="_blank" href="../concept/attribute/324.html">
             <img src="../skins/arkologik/images/plusminus/help_over.png" alt="info" />
            </a>
           </li>
          </ul>
         </span>
        </li>
        <li style="display:none">
         &nbsp;
        </li>
        <li style="display:none">
         &nbsp;
        </li>
       </ul>
      </div>
      <div id="div-smp_intact" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Intact
         </label>
         <img src="../skins/arkologik/images/onoff/chk_na.png" alt="on/off_switch" />
        </li>
       </ul>
      </div>
      <div id="div-smp_mapped" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Mapped
         </label>
         <img src="../skins/arkologik/images/onoff/chk_na.png" alt="on/off_switch" />
        </li>
       </ul>
      </div>
     </div>
     <div id="sfi_dimsframe_frame" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Find Details
       </h4>
      </div>
      <div id="number_viewer" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Length
         </label>
         <span class="inp">
          <span class="data">
           1.8cm
          </span>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Width
         </label>
         <span class="inp">
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Height
         </label>
         <span class="inp">
          <span class="data">
           0.2cm
          </span>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Diameter
         </label>
         <span class="inp">
          <span class="data">
           2.5cm
          </span>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Weight
         </label>
         <span class="inp">
          <span class="data">
           4.8g
          </span>
         </span>
        </li>
       </ul>
      </div>
      <div id="number_viewer" class="frm_subform">
       <ul>
        <li class="row">
         <label class="form_label">
          Axis
         </label>
         <span class="inp">
          <span class="data">
           12
          </span>
         </span>
        </li>
        <li class="row">
         <label class="form_label">
          Diameter (measured by coin specialist)
         </label>
         <span class="inp">
          <span class="data">
           25mm
          </span>
         </span>
        </li>
       </ul>
      </div>
     </div>
     <div id="number_viewer" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Dates
       </h4>
      </div>
      <ul>
       <li class="row">
        <span class="data">
         No number data has been added
        </span>
       </li>
      </ul>
     </div>
     <div id="cxt_xmiconf_xmi_viewer" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Linked Contexts
       </h4>
      </div>
      <ul id="existing-cxt" class="xmi_list">
       <li>
        <h5 style="width: 100%">
         Context:
         <a href="../cxt_cd/CH04SR_280.html">
          CH04SR_280
         </a>
        </h5>
        <ul id="fields-for-CH04SR_280" class="xmi_field">
         <li>
          <span class="data">
           see context sheet from CH02 for initial details; the lower parts of this wall are very strange since an extension seems to be built up against the ne face and other parts are only very loosely chinked; the sw face of the wall has largely fallen away, leaving only the lowest corses of stone; also founded directly on bedrock left high under wall.
          </span>
         </li>
        </ul>
       </li>
      </ul>
     </div>
     <div id="spf_img_display" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Photos
       </h4>
      </div>
      <ul>
       <li class="file_thumbs">
        <a href="../data/files//webthumb_1244.jpg" class="imagebox" title="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B1_m.tif">
         <img src="../data/files/arkthumb_1244.jpg" alt="file_image" />
        </a>
        <a href="http://web.corral.tacc.utexas.edu/ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B1_m.tif" alt="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B1_m.tif">
         <img src="../skins/arkologik/images/results/download_sml.png" alt="[Download]" title="Download" class="med" />
        </a>
       </li>
       <li class="file_thumbs">
        <a href="../data/files//webthumb_1245.jpg" class="imagebox" title="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B2_m.tif">
         <img src="../data/files/arkthumb_1245.jpg" alt="file_image" />
        </a>
        <a href="http://web.corral.tacc.utexas.edu/ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B2_m.tif" alt="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_B2_m.tif">
         <img src="../skins/arkologik/images/results/download_sml.png" alt="[Download]" title="Download" class="med" />
        </a>
       </li>
       <li class="file_thumbs">
        <a href="../data/files//webthumb_1246.jpg" class="imagebox" title="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S1_m.tif">
         <img src="../data/files/arkthumb_1246.jpg" alt="file_image" />
        </a>
        <a href="http://web.corral.tacc.utexas.edu/ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S1_m.tif" alt="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S1_m.tif">
         <img src="../skins/arkologik/images/results/download_sml.png" alt="[Download]" title="Download" class="med" />
        </a>
       </li>
       <li class="file_thumbs">
        <a href="../data/files//webthumb_1247.jpg" class="imagebox" title="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S2_m.tif">
         <img src="../data/files/arkthumb_1247.jpg" alt="file_image" />
        </a>
        <a href="http://web.corral.tacc.utexas.edu/ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S2_m.tif" alt="ICA/ChersonesosSouth/ChersonesosSouth_ARK/image_documentation/special_finds/photographs/master/sfi_CH04SR_2654_S2_m.tif">
         <img src="../skins/arkologik/images/results/download_sml.png" alt="[Download]" title="Download" class="med" />
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div id="column-second_column" class="secondary_col">
     <div id="sfi_events" class="mc_subform">
      <div class="sf_nav">
       <h4>
        Events
       </h4>
      </div>
      <ul id="events" class="hz_list">
       <li>
        <h5>
         Recorded By
        </h5>
        <span class="data">
         <ul class="actor_list">
          <li>
           KGC
          </li>
         </ul>
        </span>
        <h5>
         Date Analyzed
        </h5>
        <span class="data">
         22-7-2004
        </span>
       </li>
       <li>
        <h5>
         Entered By
        </h5>
        <span class="data">
         <ul class="actor_list">
          <li>
           KGC
          </li>
         </ul>
        </span>
       </li>
      </ul>
     </div>
     <div id="sfi_spat_display" class="mapview mc_subform">
      <div class="sf_nav">
       <h4>
        Spatial Data
       </h4>
      </div>
      <a id="export-png" href="../#.html">
      </a>
      <a id="image-download" href="../#.html" download="map.png">
      </a>
      <div id="popup">
      </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.2.1/proj4.js" type="text/javascript">
      </script>
      <script type="text/javascript">
       proj4.defs("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs");
    
    proj4.defs("EPSG:32633","+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs");
    
    proj4.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs");
    
    proj4.defs("EPSG:32636","+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs");
    var center = [1161146.542370356,4500173.095768951];

    view =  new ol.View({
        center: center,
        zoom: '',
        projection: 'EPSG:32636',
    });
    
    var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');

    var overlay = new ol.Overlay({
        element: container,
        map: map1,
    });
    
    var map1 = new ol.Map({
        controls: ol.control.defaults({attribution: false, compass:false}).extend([
            new ol.control.ScaleLine(),
        ]),
        interactions: ol.interaction.defaults(),
        // Use the canvas renderer because it's currently the fastest
        renderer: 'canvas',
        target: 'sfi_spat_display',
        view: view,
        overlays: [overlay],
    });

    window.styleCache={};

    $(document).ready(function() {
        map1.updateSize();
        map1.on('moveend',function(){
            var center = map1.getView().get('center');
            var extents = map1.getView().get('extents');
            centerstring = '['+center.toString()+']';
            var zoom = map1.getView().getZoom();
            console.log(zoom);
            console.log(centerstring);
            $.ajax({
                method: "POST",
                url: "/chersonesos/ark/api.php?req=update_sessionmap",
                data: { center: centerstring, zoomlevel: zoom, map_view: "", extents:extents  }
            })
            .done(function( msg ) {
                console.log("Session Updated");
            });
        });
    });var osmlayer = new ol.layer.Tile({
        source: new ol.source.OSM()
      });

osmlayer.set('name', 'osmlayer');

map1.addLayer(osmlayer);

osmlayer.setVisible( false );

document.getElementById('export-png').addEventListener('click', function() {
            var mapCanvas = document.createElement('canvas');
            var size = map1.getSize();
            mapCanvas.width = size[0];
            mapCanvas.height = size[1];
            var mapContext = mapCanvas.getContext('2d');

            Array.prototype.forEach.call(document.querySelectorAll('.ol-viewport canvas'), function(canvas) {
                console.log(canvas);
                console.log(canvas.width);

              if (canvas.width > 0) {
                var opacity = canvas.parentNode.style.opacity;
                mapContext.globalAlpha = opacity === '' ? 1 : Number(opacity);
                //var transform = canvas.style.transform;
                // Get the transform parameters from the style's transform matrix
                //var matrix = transform.match(/^matrix\(([^\(]*)\)$/)[1].split(',').map(Number);
                // Apply the transform to the export map context
                //CanvasRenderingContext2D.prototype.setTransform.apply(mapContext, matrix);
                mapContext.drawImage(canvas, 0, 0);
              }
            });
            if (navigator.msSaveBlob) {
              // link download attribuute does not work on MS browsers
              navigator.msSaveBlob(mapCanvas.msToBlob(), 'map.png');
            } else {
              var link = document.getElementById('image-download');
              link.href = mapCanvas.toDataURL();
              link.click();
            }
          
          map1.renderSync();
        })




    var first2 = true;
    var parseResponse = function(response) {
        //this is where we style on a per feature basis
        console.log("parseResponse");
        console.log(response);
        features = layer2Source.readFeatures(response);
        console.log(features);
        features.forEach(function(e,i,a){
            var properties = e.getProperties();
            e.setProperties(properties);
        });
        layer2Source.addFeatures(features);
    
    };

    var layer2Source = new ol.source.Vector({
        format: new ol.format.GeoJSON(),
        loader: function(extent, resolution, projection) {
            var url = 'https://ica.tacc.utexas.edu/chersonesos/ark/data/mapping/cxt_pg.geojson';
            jQuery.ajax({
                url: url,
                contentType: 'text/xml',
                data: '&lt;wfs:GetFeature service="WFS" version="1.1.0" outputFormat="text/javascript" xmlns:wfs="http://www.opengis.net/wfs" xmlns:ogc="http://www.opengis.net/ogc"&gt; &lt;wfs:Query typeName="final_plan" srsName="epsg:4326"&gt;&lt;ogc:Box&gt;&lt;ogc:coordinates&gt;' + extent.join(',') + ',epsg:4326&lt;/ogc:coordinates&gt;&lt;/ogc:box&gt;&lt;/wfs:query&gt;&lt;/wfs:getfeature&gt;',
                type: 'POST',
                dataType: 'jsonp',
            });
        },
        strategy: ol.loadingstrategy.bbox,
    });

    var layer2 = new ol.layer.Vector({
        source:layer2Source,
    });
    layer2.setStyle(function(feature, resolution) {

        var symbol = feature.get('symbol');

        if (!symbol) {
          symbol = 99;
        }

        cutoff = 0.04;

        if (resolution > cutoff){
        	symbol = "large" + symbol;
        } else {
        	symbol = "small" + symbol;
        }

        if (!window.styleCache[symbol]) {
          switch(symbol) {
              case "small2":
                window.styleCache[symbol] = 
                [
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#ffffff",
                        width: 0.5
                    }),
                    fill: new ol.style.Fill({
                        color: "#000000",
                    })
                })
                ]
            break;
            case "small7":
            case "small8":
            case "small9":
            case "small10":
            case "small11":
            case "small12":
            case "small13":
                window.styleCache[symbol] =
                [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#ffffff",
                        width: 0.1
                    }),
                    fill: new ol.style.Fill({
                        color: "#cccccc",
                    })
                
                })];
            break;
            case "large2":
            case "large7":
            case "large8":
            case "large9":
            case "large10":
            case "large11":
            case "large12":
            case "large13":
                window.styleCache[symbol] = [];
            break;
            default:
		window.styleCache[symbol] = [
                    new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#ffffff",
                        width: 1
                    }),
                    fill: new ol.style.Fill({
                        color: "#00ffff",
                    })
                })];                
          }
          
        }

        return window.styleCache[symbol];
      });
    
    layer2.set('name', 'cxt_pg');

    map1.addLayer(layer2);layer2.setVisible(true);layer2.setVisible(true);
    var layer1Source = new ol.source.Vector({
        projection: '',
        url: 'https://ica.tacc.utexas.edu/chersonesos/ark/data/mapping/final_plan.geojson',
        format: new ol.format.GeoJSON() });
    
    var layer1 = new ol.layer.Vector({ source: layer1Source });
layer1.setStyle(function(feature, resolution) {

        var symbol = feature.get('symbol');

        if (!symbol) {
          symbol = 99;
        }

        cutoff = 0.04;

        if (resolution > cutoff){
        	symbol = "large" + symbol;
        } else {
        	symbol = "small" + symbol;
        }

        if (!window.styleCache[symbol]) {
          switch(symbol) {
              case "small15":
                window.styleCache[symbol] = 
                [
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 0.5
                    })
                }),
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 5,
                        lineDash: [1, 9999],
                        lineCap: "butt"
                    })
                }),
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 2,
                        lineDash: [4, 9999],
                        lineCap: "butt"
                    })
                }),
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 3,
                        lineDash: [3, 9999],
                        lineCap: "butt"
                    })
                }),
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 4,
                        lineDash: [2, 9999],
                        lineCap: "butt"
                    })
                }),
                new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 1,
                        lineDash: [5, 9999],
                        lineCap: "butt"
                    })
                })
                ]
            break;
            case "small19":
                window.styleCache[symbol] =
                [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#999999",
                        lineDash: [1,1],
                        lineCap: "butt",
                        width: 0.5
                    })
                })];
            break;
            case "small18":
            case "small8":
            case "small8":
                window.styleCache[symbol] =
                [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 0.5
                    })
                })];
            break;
            case "small6":
            case "small9":
            case "small13":
                window.styleCache[symbol] =
                [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#555555",
                        width: 0.2,
                        lineDash: [1,1]
                    })
                })];
            break;
            case "large15":
            case "large6":
            case "large9":
            case "large13":
            case "large18":
            case "large19":
                window.styleCache[symbol] = [];
            break;
            case "small21":
            case "large21":
            case "small12":
            case "large12":
            	window.styleCache[symbol] = [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 1
                    })
                })];
            break;
            default:
				window.styleCache[symbol] = [new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: "#000000",
                        width: 0.1
                    })
                })];                
          }
          
        }

        return window.styleCache[symbol];
      });

    layer1.set('name', 'cxt_pl');

    map1.addLayer(layer1);layer1.setVisible(true);
    var layerconf_field_sfi_schmSource = new ol.source.Vector({
        projection: 'epsg:32636',
        url: 'https://ica.tacc.utexas.edu/chersonesos/ark/data/mapping/sfi_schm.geojson',
        format: new ol.format.GeoJSON() });
    
    var layerconf_field_sfi_schm = new ol.layer.Vector({ source: layerconf_field_sfi_schmSource });
layerconf_field_sfi_schm.setStyle(
        new ol.style.Style({
            fill: new ol.style.Fill({
                color: 'rgba(255, 255, 255, 0.0)'
            }),
            stroke: new ol.style.Stroke({
                color: 'rgba(250, 250, 250, 0.8)',
                width: 0.1
            }),
            image: new ol.style.Circle({
                radius: 0,
                fill: new ol.style.Fill({
                    color: '#ff561d'
                })
            })
        }));
layerconf_field_sfi_schm.set('selectable', true);

    firstconf_field_sfi_schm = true;
    map1.getLayers().forEach(function(i,e,a){
        if (i.get('name')=='Small Finds Schema'){
            var source = i.getSource();
            source.on('change', function (event) {
                if (source.getState() == 'ready') {
                    if(firstconf_field_sfi_schm){
                        map1.updateSize();
                        map1.getView().fit(source.getExtent(),  map1.getSize());
                        map1.render();
                        firstconf_field_sfi_schm = false;
                    }
                }
            });
        }
    });
    layerconf_field_sfi_schm.set('name', 'Small Finds Schema');

    map1.addLayer(layerconf_field_sfi_schm);layerconf_field_sfi_schm.setVisible(true);
    var overlayStyle = (function(){
        var focusstyle = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({color: 'rgba(255, 255, 0, 0.6)'}),
                stroke: new ol.style.Stroke({color: '#e29446', width: 1})
            }),
            fill: new ol.style.Fill({color: 'rgba(255, 255, 0, 0.6)'}),
            stroke: new ol.style.Stroke({color: '#e29446', width: 2}),
            zIndex: 3
        });
        
        var style = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                stroke: new ol.style.Stroke({color: '#e29446', width: 1})
            }),
            stroke: new ol.style.Stroke({color: '#e29446', width: 2}),
            zIndex: 2
        });
        return function(feature, resolution) {
            if ( typeof ark_id !== 'undefined' ) {
                if(feature.getProperties().ark_id.toUpperCase() == ark_id){
                    return [focusstyle];
                } else {
                    return [style];
                }
            } else {
                return [style];
            }
        };
    })();

    
    var multiSelectOverlay = new ol.layer.Vector({
        source: new ol.source.Vector(),
        map: map1,
        style: new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({color: 'rgba(255, 255, 255, 0.6)'}),
                stroke: new ol.style.Stroke({color: '#e29446', width: 1})
            }),
            fill: new ol.style.Fill({color: 'rgba(255, 86, 29, 0.6)'}),
            stroke: new ol.style.Stroke({color: '#e29446', width: 2})
        }),
        projection:'EPSG:32636',
    });
    multiSelectOverlay.set('name', "multiSelectOverlay");

    multiSelectOverlay.setStyle(overlayStyle);

    var collection = new ol.Collection();
    var iframes = {};
    var iframeids = [];

    var cycleFeatureData = function(iframeids, iframes, direction) {
        console.log(iframeids);
        var index = iframeids.indexOf(ark_id);
        
        if(direction!='back'){
            index += 1;
        } else {
            index -= 1;
        }
        if(index<0){
            index=iframeids.length-1;
        }
        if(index>iframeids.length-1){
            index=0;
        }
        console.log(index);
        
        iframes[ark_id].style.display = 'none';
        ark_id = iframeids[index];
        
        multiSelectOverlay.setStyle(overlayStyle);
        
        iframes[ark_id].style.display = 'inline';
        
        var titleElem = document.getElementById('overlayTitleElem');
        titleElem.href='/chersonesos/ark//micro_view.php?item_key=sfi_cd&sfi;_cd='+ark_id;

        titleElem.innerHTML = '&lt;h5&gt;Special Find '+ark_id+'&lt;/h5&gt;';

        iframes[ark_id].height = iframes[ark_id].contentWindow.document.body.scrollHeight + "px";
    }

    var displayFeatureInfo = function(pixel) {
        $('#subforms').append($(overlay.getElement()).show());
        var alreadySelected = map1.hasFeatureAtPixel(pixel, {
            layerFilter: function(layer) {
                return layer.get('name') == 'multiSelectOverlay' 
            }
        });
        var selectableLayer = map1.hasFeatureAtPixel(pixel, {
            layerFilter: function(layer) {
                return layer.get('selectable')
            }
        });
        if( alreadySelected ){
            console.log('selected');
            cycleFeatureData(iframeids, iframes, 'fore')
        } else if( selectableLayer ){
            overlay.getElement().innerHTML = '&lt;img class="loading" src="/chersonesos/ark//skins/arkologik/images/lightbox/loading.gif"&gt;&lt;/img&gt;';
            overlay.getElement().style.display = 'block';
            var data = document.createElement('div');

            iframes = {};
            iframeids = [];

            multiSelectOverlay.getSource().clear();

            map1.forEachFeatureAtPixel(pixel, function(feature, layer) {
                ark_id = feature.getProperties().ark_id.toUpperCase();
                console.log(ark_id);
                iframes[ark_id] = document.createElement('iframe');
                iframes[ark_id].setAttribute("id","popupiframe"+ark_id);
                iframes[ark_id].setAttribute("scrolling","yes");
                iframes[ark_id].setAttribute("src","api.php?req=transcludeSubform&item;_key=sfi_cd&sfi;_cd="+ark_id+"&sf;_conf=sfi_map_pop_conf&sf;_key=sfi_cd&sf;_val="+ark_id+"");
                iframes[ark_id].style.display = 'none';
                iframes[ark_id].onload= function(){
                    $('.loading').hide();
                    iframes[ark_id].height = iframes[ark_id].contentWindow.document.body.scrollHeight + "px";
                };
                if(iframeids.indexOf(ark_id)==-1){
                    iframeids.push(ark_id);
                };
                data.appendChild(iframes[ark_id]);
                multiSelectOverlay.getSource().addFeature(feature);
            });
            
            
            iframeids.sort();
            
            var titlebar = document.createElement('div');
            var backbtn = document.createElement('a');
            backbtn.id='backbtn';
            backbtn.innerHTML = '&lt;&lt;';
            backbtn.onclick = function(){cycleFeatureData(iframeids, iframes, 'back')};
            var forebtn = document.createElement('a');
            forebtn.id='forebtn';
            forebtn.innerHTML = '&gt;&gt;';
            forebtn.onclick = function(){cycleFeatureData(iframeids, iframes, 'fore')};
            var titleElem = document.createElement('a');
            titleElem.id = 'overlayTitleElem';
            titleElem.href='/chersonesos/ark//micro_view.php?item_key=sfi_cd&sfi;_cd='+ark_id;
            titleElem.innerHTML = '&lt;h5&gt;Special Find '+ark_id+'&lt;/h5&gt;';
            titlebar.appendChild(backbtn);
            titlebar.appendChild(titleElem);
            titlebar.appendChild(forebtn);
            iframes[ark_id].style.display = 'inline';
            overlay.getElement().appendChild(titlebar);
            overlay.getElement().appendChild(data);
        } else {
            iframes = {};
            iframeids = [];

            multiSelectOverlay.getSource().clear();
            multiSelectOverlay.getSource().addFeatures(collection);

            overlay.getElement().style.display = 'none';
        }
    };

    map1.on('click', function(evt) {
        var pixel = map1.getEventPixel(evt.originalEvent);
        displayFeatureInfo(pixel);
    });


    firstselectconf_field_sfi_schm =true;
    map1.getLayers().forEach(function(i,e,a){
    i.on('change', function (event) {
    var source = i.getSource();
    if (source.getState() == 'ready' && firstselectconf_field_sfi_schm ) {
    if (i.get('name')=='Small Finds Schema'){
    collection.clear();
    spat = false;
    console.log(map1.getView().getCenter());
    i.getSource().getFeatures().forEach(function(e,i,a){
    if(e.get('ark_id') != null){
    if(e.get('ark_id').toUpperCase()=='CH04SR_2654'){
    firstselectconf_field_sfi_schm = false;
    
    var selectedOverlay = new ol.layer.Vector({
        source: new ol.source.Vector(),
        map: map1,
        style: new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({color: 'rgba(255, 255, 255, 0.6)'}),
                stroke: new ol.style.Stroke({color: '#e29446', width: 1})
            }),
            fill: new ol.style.Fill({color: 'rgba(255, 86, 29, 0.6)'}),
            stroke: new ol.style.Stroke({color: '#e29446', width: 2})
        }),
        projection:'EPSG:32636',
    });
    selectedOverlay.set('name', "selectedOverlay");

    selectedOverlay.getSource().addFeature(e);
    overlay.getElement().style.display = 'none';
    spat = true;
    map1.updateSize();
    extent = e.getGeometry().getExtent();
    if(5){
    extent[0]=extent[0]-5;
    extent[1]=extent[1]-5;
    extent[2]=extent[2]+5;
    extent[3]=extent[3]+5;
}
console.log(map1.getView().getCenter());
map1.getView().fit(
extent,
map1.getSize()
);
console.log(map1.getView().getCenter());

}
}
});
if(!spat){
console.log($('#'+map1.getTarget()));
var nospat = document.createElement('div');
nospat.setAttribute("id","message");
$(nospat).html("No Spatial Data");
$('#'+map1.getTarget()).prepend(nospat);
}
}
}
});
});
      </script>
      <link rel="stylesheet" href="../lib/js/ol3/ol.css" />
      <link rel="stylesheet" href="../skins/arkologik/stylesheets/map_view.css" />
     </div>
    </div>
    <!-- end MAIN -->
   </div>
   <!-- ARK FOOTER -->
   <div id="ark_footer">
    <div class="bt-nav">
     <span>
      Guest User
     </span>
     <span>
      <a href="../micro_view.html">
       English
      </a>
     </span>
     <span>
      <a href="../micro_view.html">
       Russian
      </a>
     </span>
     <span>
      <a href="http://ark.lparchaeology.com/wiki">
       Help
      </a>
     </span>
     <span class="noborder">
      <a href="../index.html">
       Logout
      </a>
     </span>
    </div>
    <div class="credits">
     <p>
      Powered by
     </p>
     <span class="noborder">
      <a title="ARK" href="http://ark.lparchaeology.com">
       ARK
      </a>
     </span>
    </div>
   </div>
   <!-- end WRAPPER -->
  </div>
 </body>
</html>
